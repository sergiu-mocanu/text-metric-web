{% extends 'base.html' %}

{% block content %}
<form method="POST">
    {% csrf_token %}

    <div class="section-title">Baseline Script:</div>
    <label>
        <textarea name="baseline_script" placeholder="Enter the reference script...">{{ baseline_script }}</textarea>
    </label>

    <div class="section-title">AI Script:</div>
    <label>
        <textarea name="ai_script" placeholder="Enter the generated script...">{{ ai_script }}</textarea>
    </label>

    <div class="section-title">Select Metrics:</div>
    <label><input type="checkbox" id="select_all"> Select All</label>
    <div class="checkbox-group">
        {% for m in available_metrics %}
            <label><input type="checkbox" name="metrics" value="{{ m }}" class="metric_checkbox"
                {% if m in selected_metrics %}checked{% endif %}> {{ m }}</label><br>
        {% endfor %}
    </div>

    <div class="buttons">
        <input type="submit" value="Compare">
        <button type="button" onclick="window.location.href=window.location.pathname">Reset</button>
    </div>
</form>

{% if error_message %}
    <p class="error">{{ error_message }}</p>
{% endif %}

{% if similarity_scores %}
    <div class="results">
        <h2>Results</h2>
        <ul>
            {%  for metric, score in similarity_scores.items %}
                <li><b>{{ metric }}</b>: {{ score }}</li>
            {% endfor %}
        </ul>
    </div>
    <pre id="chartData" style="display:none">{{ chart_data|safe }}</pre>
    <div class="chart-container" style="margin-top: 2em">
        <canvas id="metricsChart"></canvas>
    </div>
{% endif %}


{%  if recent %}
    <h3>Recent comparisons</h3>
    <ul>
    {%  for c in recent %}
        <li>
            <strong>{{  c.created_at | date:"Y-m-d H:i" }}</strong><br>
            <em>Metrics:</em> {{ c.metrics_used }}<br>
            <em>Result:</em>
            <ul>
                {%  for key, value in c.results.items %}
                    <li>{{ key }}: {{ value }}</li>
                {% endfor %}<br>
            </ul>
        <em>Baseline excerpt: </em>
        <div class="toggle-container">
            <pre class="excerpt">{{ c.baseline_script | truncatechars:120 }}</pre>
            <pre class="full-text" style="display:none;">{{  c.baseline_script }}</pre>
            <a href="#" class="toggle-link">Show more</a><br><br>
        </div>

        <em>AI script excerpt: </em>
        <div class="toggle-container">
            <pre class="excerpt">{{ c.ai_script | truncatechars:120 }}</pre>
            <pre class="full-text" style="display:none;">{{  c.ai_script }}</pre>
            <a href="#" class="toggle-link">Show more</a><br><br>
        </div>
        </li>
    {% endfor %}
    </ul>
{% endif %}
{% endblock %}